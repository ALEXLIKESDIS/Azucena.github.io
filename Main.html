<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="/static/uv/uv.bundle.js" defer></script>
    <script src="/static/uv/uv.config.js" defer></script>
    <script src="/static/register-sw.js" defer></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K8CCSDNPV3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'G-K8CCSDNPV3');
    </script>
    <meta property="og:title" content="US4 | Home">
    <meta property="og:description" content="Search the web freely, watch your favorite movies and shows, and play your favorite gаmes with US4.">
    <meta property="og:image" content="/storage/images/logo.png">
    <meta name="keywords" content="US4">
    <link rel="manifest" href="manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="icon" href="/storage/images/googleclassroom.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa&display=swap" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Comfortaa', sans-serif;
        font-weight: bold;
      }

      body,
      html {
        height: 100%;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        background-color: black;
      }

      .tabs {
        display: flex;
        align-items: center;
        padding: 2px 5px;
        width: 100%;
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1200;
        justify-content: flex-start;
        overflow-x: auto;
        overflow-y: hidden;
        max-height: 40px;
        transition: transform 0.3s ease-in-out;
      }

      .tab {
        display: flex;
        align-items: center;
        padding: 3px 10px;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
        flex-shrink: 0;
        min-width: 15px;
        max-width: 500px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        height: 40px;
      }

      .tab.active {
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background-color: rgba(0, 0, 0, 0.2);
        color: white;
      }

      .tab:hover {
        border-radius: 10px;
        background-color: rgba(255, 255, 255, 0.1);
      }

      .tab.active:hover {
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        border-bottom-left-radius: 0px;
        border-bottom-right-radius: 0px;
        background-color: rgba(0, 0, 0, 0.2);
        color: white;
      }

      .tab .close-button {
        align-items: right;
        margin-left: 5px;
        color: white;
        cursor: pointer;
        font-size: 14px;
      }

      .add-tab-button {
        padding: 15px;
        cursor: pointer;
        background: none;
        color: white;
        border: none;
        outline: none;
        font-size: 20px;
        border-radius: 70px;
        transition: background-color 0.3s;
      }

      .add-tab-button:hover {
        background: rgba(0, 0, 0, 0.2);
      }

      .tabs::-webkit-scrollbar {
        height: 8px;
      }

      .tabs::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
      }

      .tabs::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        transition: background-color 0.3s ease-in-out;
      }

      .tabs::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.7);
      }

      .navbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0, 0, 0, 0.2);
        border-bottom: 2px solid rgba(255, 255, 255);
        padding: 10px 5%;
        color: white;
        position: fixed;
        top: 40px;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        z-index: 1100;
        transition: transform 0.3s ease-in-out;
        height: 45px;
      }

      .navbar-left,
      .navbar-right {
        display: flex;
        gap: 10px;
      }

      .nav-btn {
        text-decoration: none;
        color: white;
        font-size: 16px;
        padding: 8px 15px;
        border-radius: 70px;
        background: none;
        border: none;
        transition: background-color 0.3s;
        flex-grow: 1;
        text-align: center;
      }

      .nav-btn:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .search-bar-container {
        display: flex;
        justify-content: center;
        width: 100%;
        margin-left: 15px;
      }

      .search-bar {
        flex-grow: 1;
        padding: 10px;
        border-radius: 20px;
        border: 2px solid rgba(255, 255, 255);
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        color: white;
        font-size: 16px;
        outline: none;
        text-align: left;
        height: 30px
      }

      .search-bar::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .search-bar:focus {
        border-color: rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.5);
      }

      .content-wrapper {
        flex-grow: 1;
        overflow: hidden;
        position: relative;
        padding-top: 85px;
        padding-bottom: 60px;
        height: calc(100% - 145px);
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: none;
        position: absolute;
        /*padding-top: 1px; */
        padding-bottom: 95px;
        height: calc(100% - 45px);
      }

      iframe.active {
        display: block;
      }

      .lower-navbar {
        background: rgba(0, 0, 0, 0.2);
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        padding: 10px 0;
        border-top: 2px solid rgba(255, 255, 255);
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div class="tabs" id="tabs">
      <div class="tab active" onclick="selectTab(this)">New Tab <span class="close-button" onclick="closeTab(event)">×</span>
      </div>
      <button class="add-tab-button" onclick="addTab()">+</button>
    </div>
    <div class="navbar" id="navbar">
      <div class="navbar-left">
        <button onclick="document.querySelector('.tab-iframe.active').contentWindow.history.back()" class="nav-btn" title="Go back">
          <i class="fas fa-arrow-left"></i>
        </button>
        <button onclick="document.querySelector('.tab-iframe.active').contentWindow.history.forward()" class="nav-btn" title="Go forward">
          <i class="fas fa-arrow-right"></i>
        </button>
        <button onclick="document.querySelector('.tab-iframe.active').contentWindow.location.reload()" class="nav-btn" title="Reload">
          <i class="fas fa-redo"></i>
        </button>
        <button onclick="setIframe('/static/', 'New Tab')" class="nav-btn" title="Home">
          <i class="fa fa-home"></i>
        </button>
      </div>
      <div class="search-bar-container">
        <input type="text" id="search-input" list="internal-urls" class="search-bar" placeholder="Search or enter a URL">
      </div>
      <div class="navbar-right">
        <button onclick="openInAboutBlank()" class="nav-btn" title="Open in new window">
          <i class="fa-solid fa-up-right-from-square"></i>
        </button>
        <button onclick="toggleFullscreen()" class="nav-btn" title="Toggle fullscreen">
          <i class="fas fa-expand"></i>
        </button>
        <button onclick="inspect()" class="nav-btn" title="Inspect element">
          <i class="fa fa-code"></i>
        </button>
        <button onclick="settings()" class="nav-btn" title="Settings">
          <i class="fa fa-cog"></i>
        </button>
      </div>
    </div>
    <div class="content-wrapper" id="content-wrapper">
      <div id="loading-spinner" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: white;"></i>
      </div>
      <iframe class="tab-iframe active" src="/static/"></iframe>
    </div>
    <div class="lower-navbar">
      <button class="nav-btn" onclick="addTab('/pages/games?upd=', 'Games')" title="Games">
        <i class="fas fa-gamepad"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/heartive?upd=', 'Media')" title="Media">
        <i class="fa-solid fa-video"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/apps?upd=', 'Apps')" title="Apps">
        <i class="fa-sharp fa-solid fa-layer-group"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/partners?upd=', 'Partners')" title="Partners">
        <i class="fa-solid fa-users"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/credits?upd=', 'Credits')" title="Credits">
        <i class="fa-solid fa-book"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/data?upd=', 'Data')" title="Data">
        <i class="fa-solid fa-file-arrow-down"></i>
      </button>
      <button class="nav-btn" onclick="addTab('/pages/extra?upd=', 'Extra')" title="Extra">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <datalist id="internal-urls">
      <option value="us4://new-tab-page">
      <option value="us4://settings">
      <option value="us4://games">
      <option value="us4://media">
      <option value="us4://apps">
      <option value="us4://partners">
      <option value="us4://credits">
      <option value="us4://extra">
      <option value="us4://data">
    </datalist>
    <script>
      let tabCount = 1;

      function selectTab(tab) {
        document.querySelectorAll('.tab, .tab-iframe').forEach(el => el.classList.remove('active'));
        tab.classList.add('active');
        const tabIndex = Array.from(tab.parentNode.children).indexOf(tab);
        const iframe = document.querySelectorAll('.tab-iframe')[tabIndex];
        iframe.classList.add('active');
        updateSearchBar(iframe);
        updateTabName(iframe);
      }

      function addTab(url = '/static/', title = 'New Tab') {
        tabCount++;
        const tabsContainer = document.getElementById('tabs');
        const newTab = document.createElement('div');
        newTab.classList.add('tab');
        newTab.innerHTML = `${title} <span class="close-button" onclick="closeTab(event)">×</span>`;
        newTab.addEventListener("click", () => selectTab(newTab));
        tabsContainer.insertBefore(newTab, document.querySelector('.add-tab-button'));
        const iframe = document.createElement('iframe');
        iframe.classList.add('tab-iframe');
        const spinner = document.getElementById('loading-spinner');
        spinner.style.display = 'block';
        iframe.src = url;
        iframe.onload = function() {
          spinner.style.display = 'none';
          updateSearchBar(iframe);
          updateTabName(iframe);
        };
        document.getElementById('content-wrapper').appendChild(iframe);
        selectTab(newTab);
      }

      function closeTab(event) {
        event.stopPropagation();
        const tab = event.target.closest('.tab');
        const iframe = document.querySelectorAll('.tab-iframe')[Array.from(tab.parentNode.children).indexOf(tab)];
        let previousTab = tab.previousElementSibling || tab.nextElementSibling;
        tab.remove();
        iframe.remove();
        if (document.querySelectorAll('.tab').length === 0) {
          addTab();
        } else {
          selectTab(previousTab);
        }
      }

      function setIframe(url, title) {
        const iframe = document.querySelector('.tab-iframe.active');
        if (iframe) {
          const spinner = document.getElementById('loading-spinner');
          spinner.style.display = 'block';
          iframe.src = url;
          iframe.onload = () => {
            spinner.style.display = 'none';
            updateSearchBar(iframe);
            updateTabName(iframe);
          };
          // Update tab title immediately
          const tabIndex = Array.from(document.querySelectorAll('.tab-iframe')).indexOf(iframe);
          const tab = document.querySelectorAll('.tab')[tabIndex];
          if (tab) {
            tab.innerHTML = `${title} <span class="close-button" onclick="closeTab(event)">×</span>`;
            tab.title = title;
          }
        }
      }

      function internal(url) {
        try {
          if (url.startsWith('us4://games-frame')) {
            const path = url.replace('us4://', '/pages/');
            return setIframe(path, 'Games');
          }
          if (url.startsWith('us4://apps-frame')) {
            const path = url.replace('us4://', '/pages/');
            return setIframe(path, 'Apps');
          }
          switch (url) {
            case 'us4://new-tab-page':
              return setIframe('/static/?upd=', 'New Tab');
            case 'us4://settings':
              return setIframe('/pages/prox/settings?upd=', 'Settings');
            case 'us4://games':
              return setIframe('/pages/games?upd=', 'Games');
            case 'us4://media':
              return setIframe('/pages/heartive?upd=', 'Media');
            case 'us4://apps':
              return setIframe('/pages/apps?upd=', 'Apps');
            case 'us4://partners':
              return setIframe('/pages/partners?upd=', 'Partners');
            case 'us4://credits':
              return setIframe('/pages/credits?upd=', 'Credits');
            case 'us4://extra':
              return setIframe('/pages/extra?upd=', 'Extra');
            case 'us4://data':
              return setIframe('/pages/data?upd=', 'Data');
            case 'us4://data-usage':
              return setIframe('/pages/extra/data-use', 'Data Usage');
            case 'us4://secret':
              return setIframe('/pages/super-secret?upd', 'secret');
            case 'us4://cheese.png':
              return setIframe('/storage/images/cheese.png', 'cheese');
            default:
              return url;
          }
        } catch (e) {
          console.error('internal page failed:', e);
          return url;
        }
      }

      function search() {
        const inputRaw = document.getElementById('search-input').value.trim();
        const iframe = document.querySelector('.tab-iframe.active');
        if (!inputRaw || !iframe) return;
        const mapped = internal(inputRaw);
        if (typeof mapped === 'function') {
          mapped();
        } else {
          const isInternal = mapped === '/static/' || mapped === '/pages/prox/settings';
          let finalURL = mapped;
          if (!isInternal) {
            const hasProtocol = /^https?:\/\//i.test(mapped);
            const looksLikeURL = /\.[a-z]{2,}(\/|$)/i.test(mapped);
            if (hasProtocol) {
              finalURL = mapped;
            } else if (looksLikeURL) {
              finalURL = 'http://' + mapped;
            } else {
              finalURL = `https://duckduckgo.com/?q=${encodeURIComponent(mapped)}`;
            }
          }
          const spinner = document.getElementById('loading-spinner');
          spinner.style.display = 'block';
          iframe.src = isInternal ? mapped : `/static/embed?p=${finalURL}`;
          iframe.onload = () => {
            spinner.style.display = 'none';
            updateSearchBar(iframe);
            updateTabName(iframe);
          };
        }
      }

      function settings() {
        addTab('/pages/prox/settings', 'Settings');
      }

      function toggleFullscreen() {
        const iframe = document.querySelector('.tab-iframe.active');
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.mozRequestFullScreen) {
          iframe.mozRequestFullScreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) {
          iframe.msRequestFullscreen();
        }
      }

      function inspect() {
        window.location.href = "javascript: (function() { fetch('/storage/js/eruda.js') .then(response => { if (!response.ok) throw new Error('Network response was not ok'); return response.text(); }) .then(scriptText => eval(scriptText)) .catch(error => console.error('Error fetching or executing the script:', error)); })();"
      }
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelector(".add-tab-button").addEventListener("click", addTab);
        document.getElementById("search-input").addEventListener("keydown", (e) => {
          if (e.key === "Enter") search();
        });
      });
      const proxyPrefix = "/static/embed.html?p=";
      //unprxy
      function getUnproxifiedUrl(proxifiedUrl) {
        try {
          const hostname = window.location.hostname;
          const hostPrefix = `https://${hostname}/static/embed?p=`;
          const staticLoadPrefix = `https://${hostname}/static/load/`;
          const iframe = document.querySelector('.tab-iframe.active');
          const docHref = iframe.contentWindow.location.href;
          if (docHref.startsWith(staticLoadPrefix)) {
            const path = docHref.replace(staticLoadPrefix, "");
            const decodedUrl = __uv$config.decodeUrl(path);
            return new URL(decodedUrl);
          }
          if (docHref.includes("/pages/games-frame") || docHref.includes("/pages/apps-frame")) {
            const remaining = docHref.replace(`https://${hostname}/pages/`, "");
            return `us4://${remaining}`;
          }
          switch (docHref) {
            case `https://${hostname}/static/`:
              return "us4://new-tab-page";
            case `https://${hostname}/pages/prox/settings`:
              return "us4://settings";
            case `https://${hostname}/pages/games?upd=`:
              return "us4://games";
            case `https://${hostname}/pages/heartive?upd=`:
              return "us4://media";
            case `https://${hostname}/pages/apps?upd=`:
              return "us4://apps";
            case `https://${hostname}/pages/partners?upd=`:
              return "us4://partners";
            case `https://${hostname}/pages/credits?upd=`:
              return "us4://credits";
            case `https://${hostname}/pages/extra?upd=`:
              return "us4://extra";
            case `https://${hostname}/pages/data?upd=`:
              return "us4://data";
            case `https://${hostname}/pages/extra/data-use`:
              return "us4://data-usage";
            case `https://${hostname}/pages/super-secret?upd`:
              return "us4://secret";
            case `https://${hostname}/storage/images/cheese.png`:
              return "us4://cheese.png";
            default:
              if (docHref.startsWith(hostPrefix)) {
                return decodeURI(docHref.replace(hostPrefix, ""));
              }
              return decodeURI(docHref);
          }
        } catch (e) {
          console.error('Error unproxifying URL:', e);
          return docHref;
        }
      }
      //updsb
      function updateSearchBar(iframe) {
        try {
          let rawUrl = iframe.src;
          try {
            rawUrl = iframe.contentWindow.location.href;
          } catch {}
          const unproxifiedUrl = getUnproxifiedUrl(rawUrl);
          doc
